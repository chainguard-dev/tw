name: emptypackage

pipeline:
  - name: empty package check
    runs: |
      # Get our empty package name
      pkg=$(basename ${{targets.contextdir}})

      file_list=$(apk info --quiet --contents "$pkg" | grep -v "^$")

      # We're only really expecting a single spdx.json file in an empty package
      if [ $(echo "$file_list" | wc -l) -le 1 ] && (echo "$file_list" | grep -q ".spdx.json$"); then
        echo "PASS: Package [$pkg] seems to be empty, as expected"
      else
        echo "FAIL: Expected this package [$pkg] to be empty, but it isn't:" >&
        echo "$file_list" >&2
        exit 1
      fi
